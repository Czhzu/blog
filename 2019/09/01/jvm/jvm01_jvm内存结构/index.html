<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.0.0">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Gemini","version":"7.7.1","exturl":false,"sidebar":{"position":"left","display":"post","offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="jvm内存结构运行时数据区域java7 java8将方法区移出，变为元数据区，放在直接内存中。">
<meta name="keywords" content="jvm">
<meta property="og:type" content="article">
<meta property="og:title" content="jvm01_jvm内存结构">
<meta property="og:url" content="http:&#x2F;&#x2F;yoursite.com&#x2F;2019&#x2F;09&#x2F;01&#x2F;jvm&#x2F;jvm01_jvm%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84&#x2F;index.html">
<meta property="og:site_name" content="Chenaa&#39;s Notes">
<meta property="og:description" content="jvm内存结构运行时数据区域java7 java8将方法区移出，变为元数据区，放在直接内存中。">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https:&#x2F;&#x2F;czh-pb-source.oss-cn-hongkong.aliyuncs.com&#x2F;pic&#x2F;jvm&#x2F;jvm_2-1.png">
<meta property="og:image" content="https:&#x2F;&#x2F;czh-pb-source.oss-cn-hongkong.aliyuncs.com&#x2F;pic&#x2F;jvm&#x2F;jvm_2-6.png">
<meta property="og:image" content="https:&#x2F;&#x2F;czh-pb-source.oss-cn-hongkong.aliyuncs.com&#x2F;pic&#x2F;jvm&#x2F;jvm_2-2.png">
<meta property="og:image" content="https:&#x2F;&#x2F;czh-pb-source.oss-cn-hongkong.aliyuncs.com&#x2F;pic&#x2F;jvm&#x2F;jvm_2-7.png">
<meta property="og:image" content="https:&#x2F;&#x2F;czh-pb-source.oss-cn-hongkong.aliyuncs.com&#x2F;pic&#x2F;jvm&#x2F;jvm_2-3.jpeg">
<meta property="og:image" content="https:&#x2F;&#x2F;czh-pb-source.oss-cn-hongkong.aliyuncs.com&#x2F;pic&#x2F;jvm&#x2F;jvm_2-4.png">
<meta property="og:image" content="https:&#x2F;&#x2F;czh-pb-source.oss-cn-hongkong.aliyuncs.com&#x2F;pic&#x2F;jvm&#x2F;jvm_2-5.png">
<meta property="og:updated_time" content="2020-06-09T12:09:34.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https:&#x2F;&#x2F;czh-pb-source.oss-cn-hongkong.aliyuncs.com&#x2F;pic&#x2F;jvm&#x2F;jvm_2-1.png">

<link rel="canonical" href="http://yoursite.com/2019/09/01/jvm/jvm01_jvm%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true
  };
</script>

  <title>jvm01_jvm内存结构 | Chenaa's Notes</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Chenaa's Notes</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">尘事如潮人如水</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/01/jvm/jvm01_jvm%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.gif">
      <meta itemprop="name" content="chenaa">
      <meta itemprop="description" content="zZ..zZ..">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chenaa's Notes">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          jvm01_jvm内存结构
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-09-01 20:46:25" itemprop="dateCreated datePublished" datetime="2019-09-01T20:46:25+08:00">2019-09-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-06-09 20:09:34" itemprop="dateModified" datetime="2020-06-09T20:09:34+08:00">2020-06-09</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/jvm/" itemprop="url" rel="index"><span itemprop="name">jvm</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="jvm内存结构"><a href="#jvm内存结构" class="headerlink" title="jvm内存结构"></a>jvm内存结构</h1><h2 id="运行时数据区域"><a href="#运行时数据区域" class="headerlink" title="运行时数据区域"></a>运行时数据区域</h2><p>java7<br><img src="https://czh-pb-source.oss-cn-hongkong.aliyuncs.com/pic/jvm/jvm_2-1.png" alt=""></p>
<p>java8将方法区移出，变为元数据区，放在直接内存中。</p>
<a id="more"></a>

<p><img src="https://czh-pb-source.oss-cn-hongkong.aliyuncs.com/pic/jvm/jvm_2-6.png" alt=""></p>
<h2 id="程序计数器"><a href="#程序计数器" class="headerlink" title="程序计数器"></a>程序计数器</h2><p>程序计数器是一块较小的内存空间，可以看做当前线程所执行的字节码的行号指示器。</p>
<p>在java虚拟机的概念模型里，字节码解释器工作时就是通过改变这个计数器的值来选取下一条需要执行的字节码指令，它是程序控制流的指示器，分支、循环、跳转、异常处理、线程恢复等功能都需要依赖这个计数器完成。</p>
<p>每条线程都有自己独立的程序计数器，这类内存区域称为<strong>线程私有</strong>的内存。</p>
<p>此区域是唯一一个《java虚拟机规范》没有规定任何oom情况的区域</p>
<h2 id="java虚拟机栈"><a href="#java虚拟机栈" class="headerlink" title="java虚拟机栈"></a>java虚拟机栈</h2><p>java虚拟机栈也是线程私有的，他的生命周期和线程相同。</p>
<p>虚拟机栈描述的是<strong>java方法执行的内存模型</strong>：每个方法在执行的同时都会创建一个<strong>栈帧</strong> 用于<strong>存储局部变量表</strong>、<strong>操作数栈</strong>、<strong>动态链接</strong>、<strong>方法出口</strong>等信息。一个方法调用到执行完成的过程，对应一个栈帧在虚拟机中从入栈到出栈的过程。</p>
<p><strong>局部变量表</strong>：存放了编译器可知的各种基本数据类型（long和double占据两个局部变量空间(Slot),boolean、byte等占据1个）、对象引用（reference类型，它不等同于对象本身，可能是一个指向对象起始地址的引用指针，也可能是指向另一个代表对象的句柄或其他次对象相关的位置）和returnAddress类型（指向了一条字节码指令的地址）。</p>
<p>局部变量表所需的内存空间<strong>在编译期完成分配，不会发生变化。</strong></p>
<p><img src="https://czh-pb-source.oss-cn-hongkong.aliyuncs.com/pic/jvm/jvm_2-2.png" alt=""></p>
<h2 id="本地方法栈"><a href="#本地方法栈" class="headerlink" title="本地方法栈"></a>本地方法栈</h2><p>本地方法栈和虚拟机方法栈一样，区别是本地方法栈调用的是Native的方法和服务。(hotSpot虚拟机直接将本地方法栈和虚拟机方法栈合二为一)</p>
<h2 id="java堆"><a href="#java堆" class="headerlink" title="java堆"></a>java堆</h2><p>Java堆（Heap）是Java虚拟机所管理的内存中最大的一块，Java堆是被<strong>所有线程共享</strong>的一块内存区域，在虚拟机启动时创建。<strong>几乎所有</strong>Java对象实例都在堆上分配。</p>
<p>java堆是垃圾收集器管理的主要区域，也被称为<strong>GC堆</strong>。</p>
<p>堆还可细致分为：</p>
<ul>
<li>老年代</li>
<li>新生代<ul>
<li>Eden空间(伊甸园)</li>
<li>From Survivor 空间</li>
<li>To Survivor 空间</li>
</ul>
</li>
</ul>
<p>线程共享的java堆中可能划分出多个线程私有的<strong>分配缓存区</strong>（Thread local Allocation buffer ，<strong>TLAB</strong>）</p>
<p>-Xmx 和-Xms 分别表示堆的最大内存和初始化内存。(rawdata线上 -Xms4g -Xmx4g ，测试-Xms800m -Xmx800m)</p>
<h2 id="方法区"><a href="#方法区" class="headerlink" title="方法区"></a>方法区</h2><p>方法区和java堆一样，是各个线程共享的内存区域，用于存储已被虚拟机加载的<strong>类信息</strong>、<strong>常量</strong>、<strong>静态变量</strong>、<strong>即时编译器编译后的代码</strong>等数据(jdk6)。</p>
<p>在hotspot虚拟机上，也被称为<strong>永久代</strong>，其他虚拟机没有永久代的概念。</p>
<p>JDK6开始，hotspot团队就有放弃永久代，逐渐改用本地内存来实现方法区的计划。</p>
<p>到了JDK7，hotspot已经把原本放在永久代中的字符串常量池、静态变量等移出到本地内存中。</p>
<p>到了JDK8，放弃了永久代的概念，在本地内存中实现元空间(MetaSpace)来代替，把JDK7中永久代还剩余的内容(主要是类型信息)全部移到元空间中。</p>
<h3 id="运行时常量池"><a href="#运行时常量池" class="headerlink" title="运行时常量池"></a>运行时常量池</h3><p>运行时常量池是方法区的一部分。(jdk8以及之前)</p>
<p>运行期间也可以把常量放入常量池中，比如String类的<strong>intern()方法</strong></p>
<h2 id="直接内存"><a href="#直接内存" class="headerlink" title="直接内存"></a>直接内存</h2><p>直接内存并不是虚拟机运行时数据的一部分。</p>
<p>NIO可以使用Native函数库直接分配堆外内存，一些场景下能提高性能，避免Java堆和Native堆中来回复制数据。</p>
<h1 id="对象在虚拟机中的实现-HotSpot"><a href="#对象在虚拟机中的实现-HotSpot" class="headerlink" title="对象在虚拟机中的实现(HotSpot)"></a>对象在虚拟机中的实现(HotSpot)</h1><h2 id="对象的创建"><a href="#对象的创建" class="headerlink" title="对象的创建"></a>对象的创建</h2><p>当虚拟机遇到一条new命令，做的流程如下：</p>
<ol>
<li><strong>检查</strong> 检查这个类是否已经被加载、解析、初始化过。</li>
<li>为新生对象分配内存。</li>
<li>将分配好的内存空间初始化为零值。</li>
<li>对对象头进行设置。(哪个类的实例、如何找到类的元数据信息、对象的哈希码、GC分代年龄信息等)</li>
<li>执行<init>方法，把对象按程序员的意愿进行初始化。</li>
</ol>
<p>分配内存的两种方式：</p>
<ul>
<li><strong>指针碰撞</strong> ：<strong>假设java堆内存规整</strong>，用过的空间都在一边，把指针向空闲空间那边挪动一段与对象大小相等的距离。</li>
<li><strong>空闲列表</strong>：<strong>java堆不规整，已使用和未使用的空间交错</strong>，虚拟机维护一个列表，记录哪些内存块是可用的，分配内存的时候从列表上找一块足够大的空间给对象示例，并更新列表。</li>
</ul>
<p><strong>java堆是否规整是由垃圾收集器是否带有压缩整理功能决定</strong>的，使用Serial、ParNew等带压缩整理过程的收集器时，系统采用的分配算法是指针碰撞，使用CMS这种基于Mark-Sweep(标记-清除)的收集器时，采用空闲列表。</p>
<p>解决并发情况下的内存分配有两种方案</p>
<ol>
<li>虚拟机采用CAS配上失败重试的方式保证更新的原子性。</li>
<li>把内存分配动作，按照线程划分在不同的空间中进行，即每个线程在java堆上预先分配一小块内存，称为<strong>本地线程分配缓冲</strong>(Thread local Allocation buffer ，<strong>TLAB</strong>)。只有TLAB用完并分配新的TLAB时，才需要同步锁定。虚拟机是否使用TLAB可以通过-XX:+/-UseTLAB参数设定。</li>
</ol>
<h2 id="对象的内存模型"><a href="#对象的内存模型" class="headerlink" title="对象的内存模型"></a>对象的内存模型</h2><p>对象内存布局分三块区域：</p>
<ul>
<li>对象头</li>
<li>实例数据</li>
<li>对齐填充(不是必然存在，hotspot要求对象起始地址必须是8字节的整数倍，所以需要对齐)。</li>
</ul>
<p>对象头中有两部分数据：</p>
<ul>
<li><strong>Mark Word</strong>：<strong>用于存储对象自身的运行时数据， 如哈希码（HashCode）、GC分代年龄、锁状态标志、线程持有的锁、偏向线程ID、偏向时间戳</strong>等等，这部分数据的长度在32位和64位的虚拟机中分别为32个和64个Bits。考虑到虚拟机的空间效率，Mark Word被设计成一个非固定的数据结构以便在极小的空间内存储尽量多的信息，<strong>它会根据对象的状态复用自己的存储空间</strong>。例如在32位的HotSpot虚拟机 中对象未被锁定的状态下，Mark Word的32个Bits空间中的25Bits用于存储对象哈希码（HashCode），4Bits用于存储对象分代年龄，2Bits用于存储锁标志 位，1Bit固定为0，在其他状态（轻量级锁定、重量级锁定、GC标记、可偏向）下对象的存储内容如下表所示。</li>
</ul>
<p><img src="https://czh-pb-source.oss-cn-hongkong.aliyuncs.com/pic/jvm/jvm_2-7.png" alt=""></p>
<ul>
<li><strong>类型指针</strong>：对象指向它的类元数据的指针。</li>
</ul>
<p><img src="https://czh-pb-source.oss-cn-hongkong.aliyuncs.com/pic/jvm/jvm_2-3.jpeg" alt=""></p>
<h2 id="对象的访问定位"><a href="#对象的访问定位" class="headerlink" title="对象的访问定位"></a>对象的访问定位</h2><p>主流两种方式：</p>
<ul>
<li><strong>句柄</strong> ：优点是对象被移动时，只会改变句柄中的示例数据指针，而reference本身不需要修改。</li>
<li><strong>直接指针</strong>：优点是速度快，节省了一次指针定位的时间开销。（HotSpot是采用直接指针的方式进行对象访问的。）</li>
</ul>
<p><img src="https://czh-pb-source.oss-cn-hongkong.aliyuncs.com/pic/jvm/jvm_2-4.png" alt=""></p>
<p><img src="https://czh-pb-source.oss-cn-hongkong.aliyuncs.com/pic/jvm/jvm_2-5.png" alt=""></p>
<h1 id="OOM类型"><a href="#OOM类型" class="headerlink" title="OOM类型"></a>OOM类型</h1><h2 id="java堆溢出"><a href="#java堆溢出" class="headerlink" title="java堆溢出"></a>java堆溢出</h2><p>-Xms20m -Xmx20m -XX:+HeapDumpOnOutOfMemmoryError</p>
<p>-Xms20m -Xmx20m 限制java堆不可扩展</p>
<p>-XX:+HeapDumpOnOutOfMemmoryError 参数可以让虚拟机在出现内存溢出异常时，Dump当前的内存堆转储快照，以便之后分析。</p>
<p>解决java堆溢出异常一般需要对dump出来的快照进行分析，判断是哪里出现<strong>内存泄漏</strong>还是<strong>内存溢出</strong>。(常用工具 Eclipse Memory Analyzer JDK自带的jvisualvm可以分析dump出来的文件)</p>
<p>如果是内存泄漏，可进一步用工具查看泄漏对象的GC roots的引用链，找到为什么没有被回收的原因，确定泄漏代码的位置。</p>
<p>如果不存在内存泄漏的话，应该检查虚拟机堆参数是否可以调大，从代码上检查是否存在某些对象生命周期过长、持有时间过长的情况。</p>
<h2 id="栈溢出"><a href="#栈溢出" class="headerlink" title="栈溢出"></a>栈溢出</h2><p><strong>虚拟机栈和本地方法栈溢出</strong></p>
<p>对于HotSpot来说，-Xoss参数(设置本地方法栈大小)存在，实际上是无效的。栈容量只由-Xss参数设定。关于栈异常，有两种：</p>
<ul>
<li><p>StackOverflowError异常：线程请求栈深度大于虚拟机所允许的深度。</p>
</li>
<li><p>OutOfMemoryError异常：虚拟机扩展栈时无法申请到足够空间。(一般由于线程过多，物理内存已没有足够的可用内存分配给JVM的栈使用。)</p>
</li>
</ul>
<p><strong>每当java程序启动一个新的线程时，java虚拟机会为他分配一个栈。</strong></p>
<p><strong>建立线程过多，可能会导内存溢出</strong>，在不能减少线程数或者更换64位虚拟机的情况下，只能通过减少最大堆和减少栈容量换取更多线程。</p>
<h2 id="方法区和运行时常量池溢出"><a href="#方法区和运行时常量池溢出" class="headerlink" title="方法区和运行时常量池溢出"></a>方法区和运行时常量池溢出</h2><p>String.intern()是一个Native方法，它的作用是：如果字符串常量池中已经包含一个等于此string对象的字符串，则返回代表池中这个字符串的String对象；否则，将此string对象添加到常量池中，并返回此string对象的应用。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringInternTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String str1 = <span class="keyword">new</span> StringBuilder(<span class="string">"计算机"</span>).append(<span class="string">"软件"</span>).toString();</span><br><span class="line">        System.out.println(str1.intern() == str1);</span><br><span class="line"></span><br><span class="line">        String str2 = <span class="keyword">new</span> StringBuilder(<span class="string">"ja"</span>).append(<span class="string">"va"</span>).toString();</span><br><span class="line">        System.out.println(str2.intern() == str2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>JDK1.6 返回两个false，JDK1.7以后返回一个true和一个false。<br>1.6中，intern()方法会把首次遇到的字符串示例<strong>复制</strong>到永久代中，返回的也是永久代中的这个字符串实例的引用。</p>
<p>1.7之后，intern()的实现不会再复制实例，只是常量池中记录首次出现的示例引用，“java”默认已经在常量池中。</p>
<p>方法区中主要记录Class的相关信息，可以通过CGlib产生大量类填满它。<br>当前很多主流框架，Spring Hibernate、Mybaits，在对类进行增强时，都会使用CGlib这类字节码技术，增强类越多，就需要的方法区来保证动态生成的Class可以加载如内存。<strong>在经常动态生成大量Class的应用中，需要特别注意类的回收状况。</strong></p>
<p>常见常见如下</p>
<ol>
<li>CGlib动态产生类</li>
<li>大量JSP或动态产出JSP文件的应用(JSP第一次运行需要编译为java类)</li>
<li>基于OSGi的应用(同一个类文件，被不同加载器加载，rawdata插件模式也是如此)</li>
</ol>
<h2 id="直接内存溢出"><a href="#直接内存溢出" class="headerlink" title="直接内存溢出"></a>直接内存溢出</h2><p>DirectMemory容量可通过-XX:MaxDirectMemorySize指定，如不指定，默认和-Xmx一样。</p>
<p>由DirectMemory 导致的内存溢出，一个很明显的特质是Heap Dump文件不会看到明显的异常，如果发现oom后Dump文件很小，而程序同时使用了NIO，可以考虑这方面问题。</p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/jvm/" rel="tag"># jvm</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2019/08/22/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/mysql08_%E6%89%A9%E5%B1%95&%E9%AB%98%E5%8F%AF%E7%94%A8/" rel="prev" title="mysql08_扩展&高可用">
      <i class="fa fa-chevron-left"></i> mysql08_扩展&高可用
    </a></div>
      <div class="post-nav-item">
    <a href="/2019/10/01/jvm/jvm02_%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%7C%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D%7C%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98/" rel="next" title="jvm02_垃圾回收|内存分配|性能调优">
      jvm02_垃圾回收|内存分配|性能调优 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#jvm内存结构"><span class="nav-number">1.</span> <span class="nav-text">jvm内存结构</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#运行时数据区域"><span class="nav-number">1.1.</span> <span class="nav-text">运行时数据区域</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#程序计数器"><span class="nav-number">1.2.</span> <span class="nav-text">程序计数器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#java虚拟机栈"><span class="nav-number">1.3.</span> <span class="nav-text">java虚拟机栈</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#本地方法栈"><span class="nav-number">1.4.</span> <span class="nav-text">本地方法栈</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#java堆"><span class="nav-number">1.5.</span> <span class="nav-text">java堆</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#方法区"><span class="nav-number">1.6.</span> <span class="nav-text">方法区</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#运行时常量池"><span class="nav-number">1.6.1.</span> <span class="nav-text">运行时常量池</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#直接内存"><span class="nav-number">1.7.</span> <span class="nav-text">直接内存</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#对象在虚拟机中的实现-HotSpot"><span class="nav-number">2.</span> <span class="nav-text">对象在虚拟机中的实现(HotSpot)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#对象的创建"><span class="nav-number">2.1.</span> <span class="nav-text">对象的创建</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#对象的内存模型"><span class="nav-number">2.2.</span> <span class="nav-text">对象的内存模型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#对象的访问定位"><span class="nav-number">2.3.</span> <span class="nav-text">对象的访问定位</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#OOM类型"><span class="nav-number">3.</span> <span class="nav-text">OOM类型</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#java堆溢出"><span class="nav-number">3.1.</span> <span class="nav-text">java堆溢出</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#栈溢出"><span class="nav-number">3.2.</span> <span class="nav-text">栈溢出</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#方法区和运行时常量池溢出"><span class="nav-number">3.3.</span> <span class="nav-text">方法区和运行时常量池溢出</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#直接内存溢出"><span class="nav-number">3.4.</span> <span class="nav-text">直接内存溢出</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="chenaa"
      src="/uploads/avatar.gif">
  <p class="site-author-name" itemprop="name">chenaa</p>
  <div class="site-description" itemprop="description">zZ..zZ..</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">44</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">chenaa</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v4.0.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.7.1
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/pisces.js"></script>
<script src="/js/next-boot.js"></script>



  















  

  

</body>
</html>
